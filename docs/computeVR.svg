<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <rect width="1200" height="800" fill="white" stroke="black" stroke-width="1"/>
  
  <text x="600" y="30" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">
    computeVR() Multi-GPU Function Call Flow
  </text>
  
  <rect x="50" y="50" width="1100" height="50" fill="#f0f0f0" stroke="black"/>
  <text x="70" y="70" font-size="12">
    Input: returns=[100K points], horizons=[2,5,10,20,50,100,200]
  </text>
  <text x="70" y="85" font-size="10">
    chunk_size = 2 horizons per GPU
  </text>
  
  <rect x="50" y="120" width="1100" height="60" fill="#ffffcc" stroke="black"/>
  <text x="600" y="140" text-anchor="middle" font-size="14" font-weight="bold">
    OpenMP Creates 4 Parallel CPU Threads
  </text>
  <text x="600" y="155" text-anchor="middle" font-size="11">
    Each thread manages one GPU
  </text>
  
  <rect x="100" y="200" width="200" height="400" fill="#e6f3ff" stroke="blue" stroke-width="2"/>
  <text x="200" y="220" text-anchor="middle" font-weight="bold">GPU 0: h=[2,5]</text>
  
  <rect x="120" y="240" width="160" height="30" fill="#cce6ff" stroke="black"/>
  <text x="200" y="260" text-anchor="middle" font-size="10">Memory Allocation</text>
  
  <rect x="120" y="280" width="160" height="100" fill="white" stroke="blue"/>
  <text x="200" y="300" text-anchor="middle" font-size="10">Process h=2</text>
  <text x="200" y="315" text-anchor="middle" font-size="9">computeHPeriodReturns</text>
  <text x="200" y="330" text-anchor="middle" font-size="9">computeMeanKernel x2</text>
  <text x="200" y="345" text-anchor="middle" font-size="9">computeVarianceWelford x2</text>
  <text x="200" y="360" text-anchor="middle" font-size="9">VR = var_h/(2*var_1)</text>
  
  <rect x="120" y="390" width="160" height="100" fill="white" stroke="blue"/>
  <text x="200" y="410" text-anchor="middle" font-size="10">Process h=5</text>
  <text x="200" y="425" text-anchor="middle" font-size="9">computeHPeriodReturns</text>
  <text x="200" y="440" text-anchor="middle" font-size="9">computeMeanKernel x2</text>
  <text x="200" y="455" text-anchor="middle" font-size="9">computeVarianceWelford x2</text>
  <text x="200" y="470" text-anchor="middle" font-size="9">VR = var_h/(5*var_1)</text>
  
  <rect x="320" y="200" width="200" height="400" fill="#ffe6e6" stroke="red" stroke-width="2"/>
  <text x="420" y="220" text-anchor="middle" font-weight="bold">GPU 1: h=[10,20]</text>
  <text x="420" y="250" text-anchor="middle" font-size="11">Similar pattern...</text>
  
  <rect x="340" y="270" width="160" height="60" fill="white" stroke="red"/>
  <text x="420" y="290" text-anchor="middle" font-size="10">Process h=10</text>
  <text x="420" y="305" text-anchor="middle" font-size="9">5 kernels + VR calc</text>
  <text x="420" y="320" text-anchor="middle" font-size="9">VR = var_h/(10*var_1)</text>
  
  <rect x="340" y="340" width="160" height="60" fill="white" stroke="red"/>
  <text x="420" y="360" text-anchor="middle" font-size="10">Process h=20</text>
  <text x="420" y="375" text-anchor="middle" font-size="9">5 kernels + VR calc</text>
  <text x="420" y="390" text-anchor="middle" font-size="9">VR = var_h/(20*var_1)</text>
  
  <rect x="540" y="200" width="200" height="400" fill="#e6ffe6" stroke="green" stroke-width="2"/>
  <text x="640" y="220" text-anchor="middle" font-weight="bold">GPU 2: h=[50,100]</text>
  <text x="640" y="250" text-anchor="middle" font-size="11">Higher computation load</text>
  
  <rect x="560" y="270" width="160" height="60" fill="white" stroke="green"/>
  <text x="640" y="290" text-anchor="middle" font-size="10">Process h=50</text>
  <text x="640" y="305" text-anchor="middle" font-size="9">More summation work</text>
  
  <rect x="560" y="340" width="160" height="60" fill="white" stroke="green"/>
  <text x="640" y="360" text-anchor="middle" font-size="10">Process h=100</text>
  <text x="640" y="375" text-anchor="middle" font-size="9">Largest h-period sums</text>
  
  <rect x="760" y="200" width="200" height="400" fill="#f0e6ff" stroke="purple" stroke-width="2"/>
  <text x="860" y="220" text-anchor="middle" font-weight="bold">GPU 3: h=[200]</text>
  <text x="860" y="250" text-anchor="middle" font-size="11">Load imbalance</text>
  
  <rect x="780" y="270" width="160" height="80" fill="white" stroke="purple"/>
  <text x="860" y="295" text-anchor="middle" font-size="10">Process h=200</text>
  <text x="860" y="315" text-anchor="middle" font-size="9">Most computation</text>
  <text x="860" y="330" text-anchor="middle" font-size="9">Only 1 horizon</text>
  <text x="860" y="345" text-anchor="middle" font-size="9">Finishes early</text>
  
  <rect x="50" y="620" width="1100" height="60" fill="#333333"/>
  <text x="600" y="640" text-anchor="middle" font-size="14" fill="white" font-weight="bold">
    OpenMP Synchronization
  </text>
  <text x="600" y="655" text-anchor="middle" font-size="11" fill="white">
    All threads wait, return vr_results = [VR(2), VR(5), VR(10), VR(20), VR(50), VR(100), VR(200)]
  </text>
  
  <rect x="50" y="700" width="1100" height="80" fill="#f9f9f9" stroke="black"/>
  <text x="600" y="720" text-anchor="middle" font-size="12" font-weight="bold">
    Performance: 35 total kernel launches, 95% scaling efficiency
  </text>
  <text x="300" y="740" font-size="10">
    Memory: ~2MB per GPU (1% utilization)
  </text>
  <text x="300" y="755" font-size="10">
    Bottleneck: Memory bandwidth
  </text>
  <text x="700" y="740" font-size="10">
    Throughput: 173K-280K points/ms
  </text>
  <text x="700" y="755" font-size="10">
    All 4 GPUs work concurrently
  </text>
</svg>
